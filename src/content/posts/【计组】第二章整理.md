---
title: 【计组】第二章整理
published: 2024-10-29
description: ''
image: ''
tags: [计组]
category: ''
draft: false 
lang: ''
---
# 计组第二章
三种语言 高级语言、汇编语言、机器语言  
**章节理解维度：**

1. 高级语言（C语言）————汇编语言
2. 汇编语言（汇编指令）————机器语言（机器码）

## Outline
+ Introduction
+ Operations of the computer hardware 
+ Operands of the computer hardware
+ Signed and a numbers
+ Representing instructions in the computer
+ Logical operations
+ Instructions for making decision
+ Supporting procedures in computer hardware
+ Instruction addressing

## Introduction
 instruction set: RISC-V  
 P6  
 RISC VS CISC 对比表格  
 P9  
 Stored-program concept  
 P12 

## Arithmetic Operations
## Oprands
+ RISC-V has a 32 × 64-bit register file
    - Use for frequently accessed data
    - 64-bit data is called a “doubleword”
        * 32 x 64-bit general purpose registers x0 to x31
    - 32-bit data is called a “word” **4个字节一个”字“**  
![](https://cdn.nlark.com/yuque/0/2024/png/39305737/1730002676690-1b593a6e-e46c-4d6f-ab17-801f531c3f30.png)  
在函数调用中，寄存器 x0 是否被保留取决于调用约定。  
![](https://cdn.nlark.com/yuque/0/2024/png/39305737/1730002676803-6fda9d18-010c-4119-9732-01c0c80c1018.png)  
![](https://cdn.nlark.com/yuque/0/2024/png/39305737/1730002676935-55f21aa5-e22e-4220-9125-40a46a5f4222.png)  
![](https://cdn.nlark.com/yuque/0/2024/png/39305737/1730002677025-68703d16-8bea-46b5-953c-ee8c51e2ee46.png)
+ RISC-V does not require words to be aligned in   
memory  
![](https://cdn.nlark.com/yuque/0/2024/png/39305737/1730002677092-16e0aca2-f2ae-40ab-8d9e-60c5e2abb958.png)  
P19  
base register & offset  
![](https://cdn.nlark.com/yuque/0/2024/png/39305737/1730002677155-75bc7502-abab-4f09-afc7-6742da5e310b.png)  
P22 constant representation:
+ constant oprands
+ immediate operands

P23 Summary  
![](https://cdn.nlark.com/yuque/0/2024/png/39305737/1730002677217-9556190e-8ad0-41bf-b474-5d943e5d4306.png)

## Signed and unsigned numbers
1. Unsigned Binary Integers: ![](https://cdn.nlark.com/yuque/0/2024/png/39305737/1730002677313-11bda0f2-cf6b-485f-88a0-2997cd4c1703.png)
2. 2s-Complement Signed Integers:![](https://cdn.nlark.com/yuque/0/2024/png/39305737/1730002677408-c86bf861-f88b-4388-b14e-d7971d8cd00e.png)  
![](https://cdn.nlark.com/yuque/0/2024/png/39305737/1730002677458-d639b0c4-16fa-4d29-8473-336179b91425.png)  
 Signed Negation:Complement and add 1

P29 Sign Extension  
![](https://cdn.nlark.com/yuque/0/2024/png/39305737/1730002677546-a965a259-325a-4cd9-b24f-c9723b35cd9c.png)  
lb,lbu.

## Representing Instructions
![](https://cdn.nlark.com/yuque/0/2024/png/39305737/1730002677602-3a9d0b03-0db6-4614-bdd9-115ed56c553b.png)  
重点：寄存器的纯数字映射，RISC-V指令位宽，cpcode即为operation code（操作码）  
**四种RISC-V指令格式：**  
![](https://cdn.nlark.com/yuque/0/2024/png/39305737/1730002677665-768fe375-d3c2-4b31-8391-f1a06b4b67b4.png)

+ Instruction fields
    - opcode: operation code
    - rd: destination register number
    - funct3: 3-bit function code (additional opcode)
    - rs1: the first source register number
    - rs2: the second source register number
    - funct7: 7-bit function code (additional opcode)
+ I型指令：![](https://cdn.nlark.com/yuque/0/2024/png/39305737/1730002677736-fb68bf9f-026c-46e8-905a-5f7849084c03.png)
+ S型指令：![](https://cdn.nlark.com/yuque/0/2024/png/39305737/1730002677799-e7b7df14-1e5e-4073-ae2e-0fe524ce0a91.png)
+ RISC-V instruction encoding：![](https://cdn.nlark.com/yuque/0/2024/png/39305737/1730002677864-44d8ef21-3ebe-4d68-89a5-fdd843fba153.png)

## Logic Operations
![](https://cdn.nlark.com/yuque/0/2024/png/39305737/1730002677930-2b47f72f-8dfc-4b2c-8424-256a7c388bb7.png)  
shift left & right都是立即数指令？

![](https://cdn.nlark.com/yuque/0/2024/png/39305737/1730002677991-82382d24-4587-4190-8312-eeafdb66a1cf.png)

 · 基址寻址：ld x19, 0(x10) # temp reg x19 = A[i]  其中的0（x10）就是基址寻址  
 · 常见强制跳转：beq x0, x0, Loop 或 beq x0, x0, Exit

+ jalr（Jump And Link Register）指令：  
![](https://cdn.nlark.com/yuque/0/2024/png/39305737/1730002678050-42e1fe9d-0d78-4d9c-a235-d123a7c75422.png)  
![](https://cdn.nlark.com/yuque/0/2024/png/39305737/1730002678110-a6571800-a04e-48df-8a96-daa348405151.png)![](https://cdn.nlark.com/yuque/0/2024/png/39305737/1730002678177-7878e6cb-f7a4-461d-a749-9d1f30e531c2.png)
+ PC：当前正在执行的指令地址。一般情况下会自动递增4。**当遇到跳转（如 JAL、JALR）、分支或函数调用等指令时，PC 会被显式修改以跳转到其他位置执行。**
+ 关于Address table:（以x6为table基地址为例）  
![](https://cdn.nlark.com/yuque/0/2024/png/39305737/1730002678251-c59a5ab0-7ba5-4d92-aa03-0b87425f9c9b.png)  
![](https://cdn.nlark.com/yuque/0/2024/png/39305737/1730002678311-a57f58ed-913c-4b78-9b20-976270c574a5.png)
+ Basic Blocks（基本块）
    - 定义：一组没有分支（跳转）指令的连续指令序列  
  ![](https://cdn.nlark.com/yuque/0/2024/png/39305737/1730002678370-517e1c9f-904c-4b79-81bc-38c70787dfec.png)  
![](https://cdn.nlark.com/yuque/0/2024/png/39305737/1730002678432-4ddfb9e2-1d54-4416-ae0b-98f1f02bbe00.png)







P40  
UJ 和  ？ type 地址是双数的，舍去第一位（没有零位），加上第十二位，扩大范围。  
P43 也是I型指令

jar jalr 无条件跳转？

**C和汇编转换**

P59  
Procedure/function be used to structure programs：

+ A stored subroutine that performs a specific task based on   
the parameters with which it is provided
    - easier to understand, allow code to be reused
+ Six step
1. Place Parameters in a place where the procedure can access   
them
2. Transfer control to the procedure：jump to 
3. Acquire the storage resources needed for the procedure
4. Perform the desired task
5. Place the result value in a place where the calling program can   
access it 
6. Return control to the point of origin



堆栈：从高地址往低地址建设——>push:指针往下移——>进栈减，入栈加

leaf procedure：没有进一步的函数调用

理解🌰：  
![](https://cdn.nlark.com/yuque/0/2024/png/39305737/1730002678502-4ef37b88-5a12-49ef-bb37-9e12bc6ffebd.png)  
建议学习从例子入手，从具象到理论更容易接受

p82 PC相对寻址  
![](https://cdn.nlark.com/yuque/0/2024/png/39305737/1730002678560-ccaef7a3-9f16-42ff-b719-60e67b0093a3.png)  
机器码：2000/2（去零位）  
32位数对，考试错一位扣分，不要写漏数字！

P88 四种寻址方式：  
![](https://cdn.nlark.com/yuque/0/2024/png/39305737/1730002678619-f5cd6836-6f7a-4bb2-bad3-2d5467829f10.png)

P89   
查表判断指令是加法  
rs2,rs1在汇编语言：不要写反！

P93  
（数据）竞争——>解决：同步机制 原子操作（硬件支持）  
atomic swap of register：一次读写打包  
![](https://cdn.nlark.com/yuque/0/2024/png/39305737/1730002678681-4f631ba9-6fd2-4f49-81b7-59415dd63291.png)  
![](https://cdn.nlark.com/yuque/0/2024/png/39305737/1730002678775-ca5b552d-fa94-447d-8c06-4b49360139db.png)

P94 load reserved：预约  
rd：用于确认操作是否成功（不成功可能是因为数据改变/有其他进程在操作）  
解决竞争的方法：![](https://cdn.nlark.com/yuque/0/2024/png/39305737/1730002678846-0b08db9f-d9ba-4768-ba07-b3ca1e50ff87.png)

注意理解两种方法的区别。

P96 linker链接器  loader  
程序由很多头文件组成，用链接器链接![](https://cdn.nlark.com/yuque/0/2024/png/39305737/1730002678922-df2bb942-cbc2-4e6d-ac53-fc620fa7637c.png)  
根据object file header就能完成链接，而不需要扫描整个程序。

image file：镜像文件  
动态链接：运行更多开销  
动态静态：看需求  
Lazy Linkage：也是动态链接  
P102 右边是第二次（已经链接过了），左边是第一次（动态链接）![](https://cdn.nlark.com/yuque/0/2024/png/39305737/1730002678979-514d9a22-c5b7-4fbe-800f-0980db7e74a8.png)

间接跳转方式：不用修改主程序，跳转对应的表储存在内存里√  
P103 Java虚拟机  
P108  
![](https://cdn.nlark.com/yuque/0/2024/png/39305737/1730002679043-6c5d33c4-bc07-4a16-b485-97338b3df6b9.png)  
四个连续的mv意义？相当于堆栈。前两个mv：放进寄存器保护，避免被覆盖。后两个：拿出下一个交换的两个参数。  
寄存器存储可以代替堆栈，除非寄存器spilling  
bug：其实n没有被保护好，x11会被下一次循环改变。mv应该放在sort一开始（循环外面）  
怎么改？

Smaller is faster：寄存器数量少，访问快
